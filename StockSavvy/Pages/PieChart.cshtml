@page
@model StockSavvy.Pages.PieChart

<div id="chartContainer">
    <canvas id="chart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var palette = ['#F66D44', '#E6F69D', '#8d81b2', '#AADEA7', '#d44848', '#2D87BB',  '#9d725e', '#5ec6ec', '#86a4a6', '#64C2A6', '#FEAE65', '#ef8cdd'];
    var portfolioData = [
        { symbol: "AAPL", value: 5000 },
        { symbol: "GOOG", value: 3000 },
        { symbol: "MSFT", value: 2000 },
        { symbol: "AMZN", value: 4000 },
        { symbol: "FB", value: 2500 },
        { symbol: "TSLA", value: 3500 },
        { symbol: "NVDA", value: 2800 },
        { symbol: "NFLX", value: 2200 },
        { symbol: "JPM", value: 1800 },
        { symbol: "V", value: 3200 },
        { symbol: "BABA", value: 2700 },
        { symbol: "WMT", value: 1900 },
        { symbol: "DIS", value: 2400 },
        { symbol: "PYPL", value: 2600 },
        { symbol: "MA", value: 3100 },
        { symbol: "CRM", value: 2300 },
        { symbol: "PG", value: 1500 },
        { symbol: "NKE", value: 2000 },
        { symbol: "PFE", value: 1700 },
        { symbol: "VZ", value: 1300 },
        // Add more stocks if needed
    ];
    var totalValue = portfolioData.reduce((total, stock) => total + stock.value, 0);
    var percentageData = portfolioData.map(stock => ({
        symbol: stock.symbol,
        value: stock.value,
        percentage: ((stock.value / totalValue) * 100).toFixed(2) + "%"
    }));
    
    var donutChart = new Chart(document.getElementById('chart'), {
        type: 'doughnut',
        data: {
            labels: percentageData.map(stock => stock.symbol),
            datasets: [{
                data: percentageData.map(stock => stock.value),
                backgroundColor: palette.slice(0, percentageData.length)
            }]
        },
        options: {
            tooltips: {
                callbacks: {
                    label: function (tooltipItem, data) {
                        var dataset = data.datasets[tooltipItem.datasetIndex];
                        var index = tooltipItem.index;
                        var value = dataset.data[index];
                        var symbol = data.labels[index];
                        var percentage = percentageData[index].percentage;
                        return symbol + ": $" + value + " (" + percentage + ")";
                    }
                }
            }
        }
    });
</script>
